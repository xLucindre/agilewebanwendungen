<html>
  <form id="register-form">
    {% csrf_token %}
    <input type="text" name="username" placeholder="Username" required /><br />
    <input
      type="password"
      name="password1"
      placeholder="Password"
      required
    /><br />
    <input
      type="password"
      name="password2"
      placeholder="Confirm Password"
      required
    /><br />
    <button type="submit">Register</button>
  </form>

  <div id="message"></div>

  <script>
    document
      .getElementById("register-form")
      .addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent default form submit

        const form = e.target;
        const formData = new FormData(form);

        fetch("/backend/register/", {
          method: "POST",
          headers: {
            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]")
              .value,
          },
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (!data.error && data.redirect) {
              window.location.href = data.redirect;
            }
            if (data.error) {
              document.getElementById("message").innerText = data.error;
              console.log(data);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      });
  </script>
</html>
